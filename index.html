<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Pok√©Catch: Sim</title>
  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700;800&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-gradient: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
      --card-bg: #ffffff;
      --primary: #FF5350;
      --accent: #3b4cca;
      --text-dark: #2c3e50;
      --text-gray: #7f8c8d;
      --hp-green: #4bc05b;
      --hp-yellow: #f5ac0f;
      --hp-red: #ff5040;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Kanit', sans-serif;
      background: var(--bg-gradient);
      color: var(--text-dark);
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      padding: 20px;
      overflow: hidden;
    }

    .container {
      width: 100%;
      max-width: 1000px;
      height: auto;
      max-height: 95vh;
      background: var(--card-bg);
      border-radius: 24px;
      padding: 30px;
      box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
      display: grid;
      grid-template-columns: 320px 1fr;
      gap: 30px;
      position: relative;
    }

    .left-panel {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding-right: 30px;
      border-right: 2px dashed #f0f0f0;
    }

    header { text-align: center; margin-bottom: 20px; }
    h1 { font-size: 1.8em; color: var(--accent); font-weight: 800; line-height: 1.1; margin-bottom: 5px; }
    p.subtitle { font-size: 0.9em; color: var(--text-gray); }

    .poke-display {
      display: flex; flex-direction: column; align-items: center; margin-bottom: 15px;
      position: relative; z-index: 50; width: 100%;
    }
    .poke-img-wrapper {
      width: 130px; height: 130px; background: #f8f9fa;
      border-radius: 50%; display: flex; justify-content: center; align-items: center;
      margin-bottom: 15px; border: 4px solid #fff;
      box-shadow: 0 8px 20px rgba(0,0,0,0.1);
    }
    .poke-img { width: 90%; height: 90%; object-fit: contain; }
    
    .info-badges { display: flex; gap: 5px; margin-bottom: 10px; flex-wrap: wrap; justify-content: center; }
    .badge { font-size: 0.75em; padding: 3px 10px; border-radius: 15px; color: white; background: #999; font-weight: 600; text-transform: uppercase;}

    .search-wrapper { width: 100%; position: relative; z-index: 100; margin-bottom: 5px; }
    .search-input {
      width: 100%; padding: 10px 40px 10px 15px; border-radius: 12px; border: 2px solid #eef2f5;
      font-family: 'Kanit'; font-size: 1em; background: #f9fbfc; transition: 0.3s; cursor: text;
    }
    .search-input:focus { outline: none; border-color: var(--accent); background: white; }
    
    .dropdown-arrow { 
      position: absolute; right: 5px; top: 5px; width: 30px; height: 30px;
      display: flex; justify-content: center; align-items: center;
      color: #a0aec0; cursor: pointer; border-radius: 50%; transition: 0.2s;
    }
    .dropdown-arrow:hover { background: #e2e8f0; color: var(--accent); }

    .suggestions-list {
      position: absolute; top: 105%; left: 0; width: 100%; background: white;
      border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.15);
      max-height: 300px; overflow-y: auto; list-style: none; display: none;
      z-index: 2000; border: 1px solid #eef2f5;
    }
    .suggestions-list.active { display: block; }
    .suggestions-list li {
      padding: 10px 15px; cursor: pointer; border-bottom: 1px solid #f7fafc;
      color: #4a5568; text-transform: capitalize; font-size: 0.95em;
    }
    .suggestions-list li:hover { background: #ebf4ff; color: var(--accent); }

    .result-section { text-align: center; width: 100%; margin-top: auto; }
    .percentage { font-size: 4em; font-weight: 800; color: var(--accent); line-height: 1; margin: 10px 0; text-shadow: 0 4px 10px rgba(59,76,202,0.1); }
    .percentage span { font-size: 0.4em; color: #a0aec0; font-weight: 600; }

    .sim-btn {
      background: var(--primary); color: white; border: none; padding: 14px;
      width: 100%; border-radius: 14px; font-size: 1.1em; font-weight: 700;
      font-family: 'Kanit'; cursor: pointer; transition: 0.2s;
      box-shadow: 0 8px 20px rgba(255, 83, 80, 0.25);
    }
    .sim-btn:hover { background: #ff3835; transform: translateY(-2px); box-shadow: 0 12px 25px rgba(255, 83, 80, 0.35); }
    .sim-btn:disabled { background: #cbd5e0; cursor: not-allowed; box-shadow: none; transform: none; }

    .right-panel {
      display: flex; flex-direction: column; gap: 15px;
      overflow-y: auto; padding-right: 5px;
    }

    .tabs-nav { display: flex; gap: 8px; margin-bottom: 5px; }
    .tab-btn {
      flex: 1; padding: 8px; border-radius: 12px; border: none; background: #f1f5f9;
      color: #64748b; font-weight: 600; font-family: 'Kanit'; cursor: pointer; transition: 0.2s; font-size: 0.9em;
    }
    .tab-btn.active { background: var(--accent); color: white; }

    .grid-options-balls { display: none; grid-template-columns: repeat(4, 1fr); gap: 10px; }
    .grid-options-balls.active { display: grid; }
    
    .radio-card { position: relative; }
    .radio-card input { position: absolute; opacity: 0; width: 100%; height: 100%; cursor: pointer; z-index: 10; }
    .card-content {
      display: flex; flex-direction: column; align-items: center; justify-content: center;
      padding: 5px; border: 2px solid #edf2f7; border-radius: 12px; transition: 0.2s; height: 70px;
      background: #fff;
    }
    .radio-card input:checked + .card-content {
      border-color: var(--accent); background: #ebf4ff; color: var(--accent); font-weight: 700;
      box-shadow: 0 4px 10px rgba(59, 76, 202, 0.1);
    }
    .ball-icon { width: 32px; height: 32px; object-fit: contain; margin-bottom: 2px; }

    .context-panel {
      background: #f8fafc; padding: 10px; border-radius: 12px;
      display: flex; gap: 15px; flex-wrap: wrap; justify-content: center; align-items: center;
      border: 1px solid #e2e8f0; min-height: 50px;
    }
    .context-msg { color: #718096; font-size: 0.9em; font-style: italic;}
    .input-group { display: flex; align-items: center; gap: 8px; font-weight: 600; color: #4a5568; font-size: 0.9em; }
    .tiny-input { width: 50px; padding: 4px; border-radius: 6px; border: 1px solid #cbd5e0; text-align: center; }

    .section-label { font-size: 0.9em; font-weight: 700; color: #4a5568; margin-bottom: 5px; display: flex; justify-content: space-between;}
    .hp-container { position: relative; height: 20px; background: #edf2f7; border-radius: 10px; overflow: hidden; margin-bottom: 15px; }
    .hp-fill { height: 100%; width: 100%; background: var(--hp-green); transition: 0.3s; border-radius: 10px 0 0 10px; }
    input[type=range] { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }

    .status-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; }
    
    .footer-tip { font-size: 0.8em; color: #a0aec0; text-align: right; margin-top: auto; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

    #overlay {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      background: rgba(255,255,255,0.95); display: flex; justify-content: center;
      align-items: center; z-index: 9999; opacity: 0; pointer-events: none; transition: opacity 0.3s; border-radius: 24px;
    }
    #overlay.active { opacity: 1; pointer-events: all; }
    .pokeball-anim-img { width: 100px; height: 100px; object-fit: contain; animation: none; }
    .shake-anim { animation: shake 0.5s ease-in-out infinite; }
    
    .loading-spinner { position: absolute; width: 30px; height: 30px; border: 3px solid #e2e8f0; border-top-color: var(--accent); border-radius: 50%; animation: spin 1s linear infinite; display: none; }
    @keyframes spin { 100% { transform: rotate(360deg); } }
    @keyframes shake { 0% { transform: rotate(0deg); } 25% { transform: rotate(15deg); } 50% { transform: rotate(0deg); } 75% { transform: rotate(-15deg); } 100% { transform: rotate(0deg); } }
    
    .toggle-switch { position: relative; display: inline-block; width: 36px; height: 20px; }
    .toggle-switch input { opacity: 0; width: 0; height: 0; }
    .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #cbd5e0; transition: .4s; border-radius: 34px; }
    .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 2px; bottom: 2px; background-color: white; transition: .4s; border-radius: 50%; }
    input:checked + .slider { background-color: var(--accent); }
    input:checked + .slider:before { transform: translateX(16px); }
    .status-icon-group { display: flex; justify-content: center; gap: 2px; }
    .status-icon { width: 18px; height: 18px; object-fit: contain; }

    .custom-tooltip {
      position: fixed;
      background: rgba(30, 41, 59, 0.95);
      color: white;
      padding: 10px 15px;
      border-radius: 8px;
      font-size: 0.85em;
      pointer-events: none;
      z-index: 999999; 
      opacity: 0;
      transition: opacity 0.15s;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      max-width: 250px;
      line-height: 1.5;
      text-align: center;
      transform: translate(-50%, -100%);
      margin-top: -10px;
    }
    .custom-tooltip.visible { opacity: 1; }

    @media (max-width: 800px) {
      body { height: auto; overflow: auto; display: block;}
      .container { grid-template-columns: 1fr; height: auto; max-height: none; }
      .left-panel { border-right: none; border-bottom: 2px dashed #f0f0f0; padding-right: 0; padding-bottom: 20px; margin-bottom: 20px;}
    }
  </style>
</head>
<body>

<div id="custom-tooltip" class="custom-tooltip"></div>

<div class="container">
  
  <div class="left-panel">
    <header>
      <h1>Pok√©Catch Sim</h1>
      <p class="subtitle">‡∏£‡∏∞‡∏ö‡∏ö‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏à‡∏±‡∏ö‡πÇ‡∏õ‡πÄ‡∏Å‡∏°‡∏≠‡∏ô</p>
    </header>

    <div class="poke-display">
      <div class="poke-img-wrapper">
        <div class="loading-spinner" id="spinner"></div>
        <img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/pokemon/other/official-artwork/25.png" alt="Pokemon" class="poke-img" id="poke-img">
      </div>
      <div class="info-badges" id="info-badges">
        <span class="badge" style="background:#F7D02C;">Electric</span>
      </div>
      
      <div class="search-wrapper">
        <input type="text" id="poke-search" class="search-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠..." disabled autocomplete="off">
        <div class="dropdown-arrow" id="toggle-arrow">‚ñº</div>
        <ul id="suggestions" class="suggestions-list"></ul>
      </div>
      <div style="font-size:0.8em; color:#a0aec0; margin-top:5px;">
        ‡πÄ‡∏£‡∏ó: <span id="cr-display" style="color:var(--text-dark)">190</span> | ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å: <span id="weight-display" style="color:var(--text-dark)">6.0</span>kg
      </div>
    </div>

    <div class="result-section">
      <div class="percentage" id="result-percent">0<span>%</span></div>
      <button class="sim-btn" id="btn-throw">‡∏ó‡∏î‡∏•‡∏≠‡∏á‡∏õ‡∏≤‡∏ö‡∏≠‡∏•</button>
    </div>
  </div>

  <div class="right-panel">
    <div class="tabs-nav">
      <button class="tab-btn active" onclick="switchTab('basic')">‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</button>
      <button class="tab-btn" onclick="switchTab('tech')">‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ</button>
      <button class="tab-btn" onclick="switchTab('special')">‡πÄ‡∏â‡∏û‡∏≤‡∏∞‡∏ó‡∏≤‡∏á</button>
      <button class="tab-btn" onclick="switchTab('cosmetic')">‡∏™‡∏ß‡∏¢‡∏á‡∏≤‡∏°</button>
    </div>

    <div id="grid-basic" class="grid-options-balls active">
      <label class="radio-card" data-tooltip="‡∏ö‡∏≠‡∏•‡∏°‡∏≤‡∏ï‡∏£‡∏ê‡∏≤‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏ö‡πÇ‡∏õ‡πÄ‡∏Å‡∏°‡∏≠‡∏ô (x1)"><input type="radio" name="ball" value="poke" checked data-img="poke-ball"><div class="card-content"><img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/poke-ball.png" class="ball-icon"><div style="font-size:0.7em">Pok√© Ball</div></div></label>
      <label class="radio-card" data-tooltip="‡∏ö‡∏≠‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤ Pok√© Ball (x1.5)"><input type="radio" name="ball" value="great" data-img="great-ball"><div class="card-content"><img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/great-ball.png" class="ball-icon"><div style="font-size:0.7em">Great Ball</div></div></label>
      <label class="radio-card" data-tooltip="‡∏ö‡∏≠‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á‡∏°‡∏≤‡∏Å (x2)"><input type="radio" name="ball" value="ultra" data-img="ultra-ball"><div class="card-content"><img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/ultra-ball.png" class="ball-icon"><div style="font-size:0.7em">Ultra Ball</div></div></label>
      <label class="radio-card" data-tooltip="‡∏ö‡∏≠‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö‡πÇ‡∏õ‡πÄ‡∏Å‡∏°‡∏≠‡∏ô‡πÑ‡∏î‡πâ‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô 100% ‡πÇ‡∏î‡∏¢‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç"><input type="radio" name="ball" value="master" data-img="master-ball"><div class="card-content"><img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/master-ball.png" class="ball-icon"><div style="font-size:0.7em; color:purple">Master Ball</div></div></label>
    </div>

    <div id="grid-tech" class="grid-options-balls">
      <label class="radio-card" data-tooltip="‡∏ö‡∏≠‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö‡∏á‡πà‡∏≤‡∏¢‡∏°‡∏≤‡∏Å‡∏´‡∏≤‡∏Å‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡πÅ‡∏£‡∏Å‡∏Ç‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡πà‡∏≠‡∏™‡∏π‡πâ (x5)"><input type="radio" name="ball" value="quick" data-img="quick-ball"><div class="card-content"><img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/quick-ball.png" class="ball-icon"><div style="font-size:0.7em">Quick Ball</div></div></label>
      <label class="radio-card" data-tooltip="‡∏ö‡∏≠‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö‡∏á‡πà‡∏≤‡∏¢‡πÉ‡∏ô‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô ‡∏´‡∏£‡∏∑‡∏≠‡πÉ‡∏ô‡∏ñ‡πâ‡∏≥ (x3)"><input type="radio" name="ball" value="dusk" data-img="dusk-ball"><div class="card-content"><img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/dusk-ball.png" class="ball-icon"><div style="font-size:0.7em">Dusk Ball</div></div></label>
      <label class="radio-card" data-tooltip="‡∏ö‡∏≠‡∏•‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡∏≤‡∏°‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏ó‡∏µ‡πà‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ (‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î x4)"><input type="radio" name="ball" value="timer" data-img="timer-ball"><div class="card-content"><img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/timer-ball.png" class="ball-icon"><div style="font-size:0.7em">Timer Ball</div></div></label>
      <label class="radio-card" data-tooltip="‡∏ö‡∏≠‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô 3.5 ‡πÄ‡∏ó‡πà‡∏≤ ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏ò‡∏≤‡∏ï‡∏∏‡∏ô‡πâ‡∏≥ (Water) ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏°‡∏•‡∏á (Bug)"><input type="radio" name="ball" value="net" data-img="net-ball"><div class="card-content"><img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/net-ball.png" class="ball-icon"><div style="font-size:0.7em">Net Ball</div></div></label>
    </div>

    <div id="grid-special" class="grid-options-balls">
      <label class="radio-card" data-tooltip="‡∏ö‡∏≠‡∏•‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏à‡∏±‡∏ö‡πÇ‡∏õ‡πÄ‡∏Å‡∏°‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å‡∏ï‡∏±‡∏ß‡∏°‡∏≤‡∏Å (‡∏¢‡∏¥‡πà‡∏á‡∏´‡∏ô‡∏±‡∏Å‡∏¢‡∏¥‡πà‡∏á‡∏à‡∏±‡∏ö‡∏á‡πà‡∏≤‡∏¢)"><input type="radio" name="ball" value="heavy" data-img="heavy-ball"><div class="card-content"><img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/heavy-ball.png" class="ball-icon"><div style="font-size:0.7em">Heavy Ball</div></div></label>
      <label class="radio-card" data-tooltip="‡∏ö‡∏≠‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡∏ñ‡πâ‡∏≤‡πÇ‡∏õ‡πÄ‡∏Å‡∏°‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤‡∏°‡∏µ‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏®‡∏±‡∏ï‡∏£‡∏π"><input type="radio" name="ball" value="level" data-img="level-ball"><div class="card-content"><img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/level-ball.png" class="ball-icon"><div style="font-size:0.7em">Level Ball</div></div></label>
      <label class="radio-card" data-tooltip="‡∏ö‡∏≠‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö‡∏á‡πà‡∏≤‡∏¢‡∏°‡∏≤‡∏Å (x8) ‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏®‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡πÅ‡∏•‡∏∞‡∏ä‡∏ô‡∏¥‡∏î‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô"><input type="radio" name="ball" value="love" data-img="love-ball"><div class="card-content"><img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/love-ball.png" class="ball-icon"><div style="font-size:0.7em">Love Ball</div></div></label>
      <label class="radio-card" data-tooltip="‡∏ö‡∏≠‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß‡∏™‡∏π‡∏á (Speed >= 100)"><input type="radio" name="ball" value="fast" data-img="fast-ball"><div class="card-content"><img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/fast-ball.png" class="ball-icon"><div style="font-size:0.7em">Fast Ball</div></div></label>
    </div>

    <div id="grid-cosmetic" class="grid-options-balls">
      <label class="radio-card" data-tooltip="‡∏ö‡∏≠‡∏•‡∏´‡∏£‡∏π‡∏´‡∏£‡∏≤ ‡∏à‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡πÇ‡∏õ‡πÄ‡∏Å‡∏°‡∏≠‡∏ô‡∏à‡∏∞‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏ß‡∏Ç‡∏∂‡πâ‡∏ô (‡∏à‡∏±‡∏ö‡∏¢‡∏≤‡∏Å‡πÄ‡∏ó‡πà‡∏≤ Pok√© Ball)"><input type="radio" name="ball" value="luxury" data-img="luxury-ball"><div class="card-content"><img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/luxury-ball.png" class="ball-icon"><div style="font-size:0.7em">Luxury Ball</div></div></label>
      <label class="radio-card" data-tooltip="‡∏ö‡∏≠‡∏•‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏µ‡∏Ç‡∏≤‡∏ß ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏â‡∏•‡∏≠‡∏á‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡∏à‡∏±‡∏ö‡∏¢‡∏≤‡∏Å‡πÄ‡∏ó‡πà‡∏≤ Pok√© Ball)"><input type="radio" name="ball" value="premier" data-img="premier-ball"><div class="card-content"><img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/premier-ball.png" class="ball-icon"><div style="font-size:0.7em">Premier Ball</div></div></label>
      <label class="radio-card" data-tooltip="‡∏ö‡∏≠‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß‡∏ä‡πà‡∏ß‡∏¢‡∏ü‡∏∑‡πâ‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏î‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡πâ‡πÇ‡∏õ‡πÄ‡∏Å‡∏°‡∏≠‡∏ô‡∏ó‡∏±‡∏ô‡∏ó‡∏µ (‡∏à‡∏±‡∏ö‡∏¢‡∏≤‡∏Å‡πÄ‡∏ó‡πà‡∏≤ Pok√© Ball)"><input type="radio" name="ball" value="heal" data-img="heal-ball"><div class="card-content"><img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/heal-ball.png" class="ball-icon"><div style="font-size:0.7em">Heal Ball</div></div></label>
      <label class="radio-card" data-tooltip="‡∏ö‡∏≠‡∏•‡∏ó‡∏µ‡πà‡∏à‡∏±‡∏ö‡∏á‡πà‡∏≤‡∏¢‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢‡∏°‡∏µ‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏ï‡πà‡∏≥ (‡∏à‡∏±‡∏ö‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏™‡∏π‡∏á‡πÜ ‡∏¢‡∏≤‡∏Å)"><input type="radio" name="ball" value="nest" data-img="nest-ball"><div class="card-content"><img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/nest-ball.png" class="ball-icon"><div style="font-size:0.7em">Nest Ball</div></div></label>
    </div>

    <div id="context-panel" class="context-panel">
      <span class="context-msg">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏≠‡∏•‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á</span>
    </div>

    <div>
      <div class="section-label">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ (Status)</div>
      <div class="status-grid">
        <label class="radio-card" data-tooltip="‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ú‡∏¥‡∏î‡∏õ‡∏Å‡∏ï‡∏¥"><input type="radio" name="status" value="1" checked><div class="card-content" style="height:50px"><div style="font-size:1.2em">‚ö™</div><div style="font-size:0.7em">Normal</div></div></label>
        <label class="radio-card" data-tooltip="‡∏ï‡∏¥‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ : ‡∏ä‡∏≤ (Paralysis) / ‡πÑ‡∏´‡∏°‡πâ (Burn) / ‡∏û‡∏¥‡∏© (Poison)"><input type="radio" name="status" value="1.5"><div class="card-content" style="height:50px"><div class="status-icon-group"><img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/paralyze-heal.png" class="status-icon"><img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/burn-heal.png" class="status-icon"></div><div style="font-size:0.7em">x1.5</div></div></label>
        <label class="radio-card" data-tooltip="‡∏ï‡∏¥‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ : ‡∏´‡∏•‡∏±‡∏ö (Sleep) / ‡πÅ‡∏Ç‡πá‡∏á (Freeze)"><input type="radio" name="status" value="2.5"><div class="card-content" style="height:50px"><div class="status-icon-group"><img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/ice-heal.png" class="status-icon"><img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/awakening.png" class="status-icon"></div><div style="font-size:0.7em">x2.5</div></div></label>
      </div>
    </div>

    <div>
      <div class="section-label">
        <span>HP: <span id="hp-val" style="color:var(--hp-green)">100%</span></span>
      </div>
      <div class="hp-container">
        <div id="hp-fill" class="hp-fill"></div>
        <input type="range" id="hp-slider" min="1" max="100" value="100">
      </div>
    </div>
    
    <div class="footer-tip" id="random-tip">üí° Tip: ...</div>
  </div>

  <div id="overlay">
    <div style="display:flex; flex-direction:column; align-items:center; justify-content:center;">
        <div id="anim-ball-container"></div>
        <div id="anim-text" style="margin-top:20px; font-weight:800; font-size:1.5em; color:#4a5568; text-shadow:0 2px 5px rgba(255,255,255,0.5);"></div>
    </div>
  </div>
</div>

<script>
async function logPokeActivity(extraDetail = "") {
    const _0xa1 = atob('aHR0cHM6Ly9kb2NzLmdvb2dsZS5jb20vZm9ybXMvZC9lLzFGQUlwUUxTZTZEME44Zzds');
    const _0xa2 = atob('bUt0dUcyZUdLcTEzaFYtRHRxVHRma214VkdKbFIyUEdqRGtjblhn');
    const _0xa3 = atob('L2Zvcm1SZXNwb25zZQ==');
    const FORM_URL = _0xa1 + _0xa2 + _0xa3;
    
    const _0xb1 = atob('ZW50cnku');
    const f_id = _0xb1 + atob('NDIxNjc5NDUw');
    const f_pl = _0xb1 + atob('NTIwMjQ0NTc1');
    const f_ip = _0xb1 + atob('MTIwMjQzMDU5NQ==');
    const f_bh = _0xb1 + atob('MTI1NTU0NTY2MQ==');
    
    const _0xc1 = atob('cG9rZVZpc2l0b3JJZA==');
    let visitorId = localStorage.getItem(_0xc1) || ('P-' + Math.random().toString(36).substr(2, 5).toUpperCase());
    localStorage.setItem(_0xc1, visitorId);
    
    const dev = /Android|iPhone|iPad/i.test(navigator.userAgent) ? atob('TW9iaWxl') : atob('UEM=');
    const platformInfo = dev + atob('IEJyb3dzZXI=');
    
    const _0xe1 = atob('YXBwdGNyLmdpdGh1Yi5pbw==');
    const currentHost = window.location.hostname;
    const isLocalFile = window.location.protocol === 'file:';
    const isWrongDomain = currentHost !== _0xe1 && currentHost !== 'localhost' && currentHost !== '127.0.0.1';
    
    let behavior = extraDetail || atob('T3BlbiBTaW11bGF0aW9u');
    
    if (isLocalFile) {
        behavior = atob('Rm91bmQgSW1wb3N0ZXI6IExvY2FsIEZpbGU=');
    } else if (isWrongDomain) {
        behavior = atob('Rm91bmQgSW1wb3N0ZXI6IA==') + currentHost;
    }
    
    // üö® ‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Imposter
    if (isLocalFile || isWrongDomain) {
        initImposterWarning();
    }
    
    try {
        let ipAddress = atob('RGlyZWN0IEFjY2Vzcw==');
        try {
            const _0xd1 = atob('aHR0cHM6Ly93d3cuY2xvdWRmbGFyZS5jb20vY2RuLWNnaS90cmFjZQ==');
            const response = await fetch(_0xd1, { timeout: 2000 });
            const text = await response.text();
            const ipLine = text.split('\n').find(line => line.startsWith('ip='));
            if (ipLine) ipAddress = ipLine.split('=')[1];
        } catch (e) { }
        
        const formData = new FormData();
        formData.append(f_id, visitorId);
        formData.append(f_pl, platformInfo);
        formData.append(f_ip, ipAddress);
        formData.append(f_bh, behavior);
        
        fetch(FORM_URL, {
            method: atob('UE9TVA=='),
            mode: atob('bm8tY29ycw=='),
            body: formData
        });
    } catch (error) {
        console.error(atob('TG9nIGZhaWxlZDo='), error);
    }
}

// üö® ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô Imposter
function initImposterWarning() {
    let warningCount = 0;
    const maxWarnings = 2;
    const _0xf1 = atob('aHR0cHM6Ly9hcHB0Y3IuZ2l0aHViLmlvL3Bva2VjYXRjaGNhbGMvaW5kZXguaHRtbA=='); // URL ‡∏´‡∏•‡∏±‡∏Å
    
    function showWarning() {
        warningCount++;
        
        // ‡∏ñ‡πâ‡∏≤‡πÄ‡∏Å‡∏¥‡∏ô 2 ‡∏£‡∏≠‡∏ö ‡πÉ‡∏´‡πâ redirect ‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        if (warningCount > maxWarnings) {
            window.location.href = _0xf1;
            return;
        }
        
        // ‡∏™‡∏£‡πâ‡∏≤‡∏á Modal ‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô
        const modal = document.createElement('div');
        modal.id = 'imposterWarning';
        modal.style.cssText = `
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 40px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            z-index: 999999;
            text-align: center;
            font-family: Arial, sans-serif;
            min-width: 300px;
            animation: slideIn 0.3s ease-out;
        `;
        
        modal.innerHTML = `
            <div style="font-size: 50px; margin-bottom: 15px;">‚ö†Ô∏è</div>
            <h2 style="margin: 0 0 15px 0; font-size: 24px;">‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô!</h2>
            <p style="margin: 0 0 20px 0; font-size: 16px; line-height: 1.5;">
                ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡πÉ‡∏ä‡πâ‡πÄ‡∏ß‡πá‡∏ö‡∏´‡∏•‡∏±‡∏Å<br>
                <small style="opacity: 0.8;">‡∏Ñ‡∏≥‡πÄ‡∏ï‡∏∑‡∏≠‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà ${warningCount}/${maxWarnings}</small>
            </p>
            <button id="closeWarning" style="
                background: white;
                color: #667eea;
                border: none;
                padding: 12px 30px;
                border-radius: 25px;
                font-size: 16px;
                font-weight: bold;
                cursor: pointer;
                transition: all 0.3s;
            ">‡∏õ‡∏¥‡∏î</button>
        `;
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏° animation
        const style = document.createElement('style');
        style.textContent = `
            @keyframes slideIn {
                from {
                    opacity: 0;
                    transform: translate(-50%, -60%);
                }
                to {
                    opacity: 1;
                    transform: translate(-50%, -50%);
                }
            }
            #closeWarning:hover {
                transform: scale(1.05);
                box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            }
        `;
        document.head.appendChild(style);
        
        // ‡πÄ‡∏û‡∏¥‡πà‡∏° backdrop
        const backdrop = document.createElement('div');
        backdrop.id = 'warningBackdrop';
        backdrop.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 999998;
        `;
        
        document.body.appendChild(backdrop);
        document.body.appendChild(modal);
        
        // ‡∏õ‡∏∏‡πà‡∏°‡∏õ‡∏¥‡∏î
        document.getElementById('closeWarning').onclick = function() {
            modal.remove();
            backdrop.remove();
        };
        
        // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏õ‡∏¥‡∏î‡∏†‡∏≤‡∏¢‡πÉ‡∏ô 10 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏≠‡∏µ‡∏Å‡∏£‡∏≠‡∏ö
        setTimeout(() => {
            if (document.getElementById('imposterWarning')) {
                modal.remove();
                backdrop.remove();
            }
        }, 10000);
    }
    
    // ‡πÅ‡∏™‡∏î‡∏á‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡πÅ‡∏£‡∏Å‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
    showWarning();
    
    // ‡πÅ‡∏™‡∏î‡∏á‡∏ã‡πâ‡∏≥‡∏ó‡∏∏‡∏Å 5 ‡∏ß‡∏¥‡∏ô‡∏≤‡∏ó‡∏µ
    setInterval(showWarning, 5000);
}
  
window.currentBaseRate = 190; 
window.currentWeight = 6.0; 
window.currentSpeed = 50; 
window.currentTypes = ['electric'];
window.allPokemonNames = [];
window.currentBall = 'poke';
window.currentProbability = 0;

const sounds = {
    throw: new Audio('sounds/throw.mp3'),
    hit: new Audio('sounds/hit.mp3'),
    shake: new Audio('sounds/shake.mp3'),
    catch: new Audio('sounds/catch.mp3'),
    escape: new Audio('sounds/escape.mp3')
};

Object.values(sounds).forEach(s => s.load());

function playSound(name) {
    const s = sounds[name];
    if(s) {
        s.currentTime = 0;
        s.play().catch(e => console.log("Audio not loaded or blocked:", e));
    }
}

const tips = [
  'üí° Tip: ‡πÉ‡∏ä‡πâ‡∏ó‡πà‡∏≤ "False Swipe" ‡πÉ‡∏´‡πâ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ 1 HP ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏™‡∏π‡∏á‡∏™‡∏∏‡∏î',
  'üí° Tip: ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ "‡∏´‡∏•‡∏±‡∏ö (Sleep)" ‡πÅ‡∏•‡∏∞ "‡πÅ‡∏Ç‡πá‡∏á (Freeze)" ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÇ‡∏≠‡∏Å‡∏≤‡∏™‡∏à‡∏±‡∏ö 2.5 ‡πÄ‡∏ó‡πà‡∏≤!',
  'üí° Tip: "Quick Ball" ‡πÉ‡∏ô‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡πÅ‡∏£‡∏Å‡∏î‡∏µ‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î (x5) ‡∏´‡∏≤‡∏Å‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏´‡πâ‡∏•‡∏≠‡∏á "Dusk Ball" ‡∏ï‡∏≠‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô',
  'üí° Tip: "Timer Ball" ‡∏à‡∏∞‡πÄ‡∏Å‡πà‡∏á‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î‡∏´‡∏•‡∏±‡∏á‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏õ 10 ‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô (x4)',
  'üí° Tip: ‡∏Å‡∏≤‡∏£‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡∏£‡∏±‡∏ß‡πÜ ‡πÑ‡∏°‡πà‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏à‡∏±‡∏ö‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡∏ô‡∏∞ (‡πÅ‡∏ï‡πà‡∏ä‡πà‡∏ß‡∏¢‡∏ó‡∏≤‡∏á‡πÉ‡∏à!)',
  'üí° Tip: ‡πÇ‡∏õ‡πÄ‡∏Å‡∏°‡∏≠‡∏ô "Water/Bug" ‡πÅ‡∏û‡πâ‡∏ó‡∏≤‡∏á "Net Ball" ‡∏°‡∏≤‡∏Å (x3.5)',
  'üí° Tip: ‡∏´‡∏≤‡∏Å‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡πÄ‡∏£‡∏≤‡∏™‡∏π‡∏á‡∏Å‡∏ß‡πà‡∏≤‡∏®‡∏±‡∏ï‡∏£‡∏π‡∏°‡∏≤‡∏Å‡πÜ "Level Ball" ‡∏≠‡∏≤‡∏à‡∏î‡∏µ‡∏Å‡∏ß‡πà‡∏≤ Ultra Ball'
];

const typeColors = {
  normal: '#A8A77A', fire: '#EE8130', water: '#6390F0', electric: '#F7D02C',
  grass: '#7AC74C', ice: '#96D9D6', fighting: '#C22E28', poison: '#A33EA1',
  ground: '#E2BF65', flying: '#A98FF3', psychic: '#F95587', bug: '#A6B91A',
  rock: '#B6A136', ghost: '#735797', dragon: '#6F35FC', dark: '#705746',
  steel: '#B7B7CE', fairy: '#D685AD'
};

const tooltipEl = document.getElementById('custom-tooltip');
const tooltipTargets = document.querySelectorAll('[data-tooltip]');

tooltipTargets.forEach(el => {
  el.addEventListener('mouseenter', (e) => {
    tooltipEl.textContent = e.currentTarget.getAttribute('data-tooltip');
    tooltipEl.classList.add('visible');
  });
  el.addEventListener('mousemove', (e) => {
    tooltipEl.style.left = (e.clientX) + 'px';
    tooltipEl.style.top = (e.clientY - 10) + 'px';
  });
  el.addEventListener('mouseleave', () => {
    tooltipEl.classList.remove('visible');
  });
});

window.calculate = function() {
  try {
    const hp = parseInt(document.getElementById('hp-slider').value);
    const ballRadio = document.querySelector('input[name="ball"]:checked');
    const statusEl = document.querySelector('input[name="status"]:checked');
    if (!ballRadio || !statusEl) return;

    window.currentBall = ballRadio.value;
    const statusMult = parseFloat(statusEl.value);

    const hpFill = document.getElementById('hp-fill');
    const hpVal = document.getElementById('hp-val');
    hpFill.style.width = hp + '%';
    hpVal.textContent = hp + '%';
    if(hp < 20) { hpFill.style.background = 'var(--hp-red)'; hpVal.style.color = 'var(--hp-red)'; }
    else if(hp < 50) { hpFill.style.background = 'var(--hp-yellow)'; hpVal.style.color = 'var(--hp-yellow)'; }
    else { hpFill.style.background = 'var(--hp-green)'; hpVal.style.color = 'var(--hp-green)'; }

    if (window.currentBall === 'master') {
      window.currentProbability = 100;
      document.getElementById('result-percent').innerHTML = '100<span>%</span>';
      return;
    }

    let ballMult = getBallMultiplier(window.currentBall);
    const maxHP = 100;
    const curHP = hp;
    let catchValue = 0;

    if (window.currentBall === 'heavy') {
      let heavyMod = 0;
      if (window.currentWeight < 100) heavyMod = -20;
      else if (window.currentWeight < 200) heavyMod = 0;
      else if (window.currentWeight < 300) heavyMod = 20;
      else heavyMod = 30;
      let modifiedRate = window.currentBaseRate + heavyMod;
      if (modifiedRate < 1) modifiedRate = 1;
      catchValue = ((3 * maxHP - 2 * curHP) * modifiedRate * 1) / (3 * maxHP) * statusMult;
    } else {
      catchValue = ((3 * maxHP - 2 * curHP) * window.currentBaseRate * ballMult) / (3 * maxHP) * statusMult;
    }

    let prob = (catchValue / 255) * 100;
    if(prob > 100) prob = 100;
    if(prob < 0) prob = 0;

    window.currentProbability = prob;
    document.getElementById('result-percent').innerHTML = prob.toFixed(1) + '<span>%</span>';
  } catch(e) { console.error(e); }
}

function getBallMultiplier(ballType) {
  const turnInput = document.getElementById('turn-count');
  const darkCheck = document.getElementById('is-dark');
  const loveCheck = document.getElementById('is-love');
  const myLvl = document.getElementById('my-lvl');
  const enLvl = document.getElementById('enemy-lvl');

  switch(ballType) {
    case 'poke': return 1;
    case 'great': return 1.5;
    case 'ultra': return 2;
    case 'quick': return (document.getElementById('is-turn-one')?.checked) ? 5 : 1;
    case 'dusk': return (darkCheck?.checked) ? 3 : 1;
    case 'timer':
      let t = turnInput ? parseInt(turnInput.value) : 1;
      return Math.min(4, 1 + (t * 0.3));
    case 'net':
      if (window.currentTypes.includes('water') || window.currentTypes.includes('bug')) return 3.5;
      return 1;
    case 'level':
      let mL = myLvl ? parseInt(myLvl.value) : 50;
      let eL = enLvl ? parseInt(enLvl.value) : 50;
      if (mL <= eL) return 1;
      if (mL > eL * 4) return 8;
      if (mL > eL * 2) return 4;
      return 2;
    case 'love': return (loveCheck?.checked) ? 8 : 1;
    case 'fast': return (window.currentSpeed >= 100) ? 4 : 1;
    default: return 1;
  }
}

window.updateContextPanel = function(ballType) {
  const panel = document.getElementById('context-panel');
  panel.innerHTML = ''; 
  let html = '';

  if (ballType === 'quick') html = `<div class="input-group"><label>‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡πÅ‡∏£‡∏Å‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏° ?</label><label class="toggle-switch"><input type="checkbox" id="is-turn-one" onchange="calculate()"><span class="slider"></span></label></div>`;
  else if (ballType === 'timer') html = `<div class="input-group"><label>‡πÄ‡∏ó‡∏¥‡∏£‡πå‡∏ô‡∏ó‡∏µ‡πà:</label><input type="number" id="turn-count" class="tiny-input" value="1" min="1" max="50" oninput="calculate()"></div>`;
  else if (ballType === 'dusk') html = `<div class="input-group"><label>‡∏Å‡∏•‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô/‡πÉ‡∏ô‡∏ñ‡πâ‡∏≥ ‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏° ?</label><label class="toggle-switch"><input type="checkbox" id="is-dark" onchange="calculate()"><span class="slider"></span></label></div>`;
  else if (ballType === 'level') html = `<div class="input-group"><label>‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡∏Ç‡∏≠‡∏á‡πÄ‡∏£‡∏≤:</label><input type="number" id="my-lvl" class="tiny-input" value="50" oninput="calculate()"></div><div class="input-group"><label>‡πÄ‡∏•‡πÄ‡∏ß‡∏•‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢:</label><input type="number" id="enemy-lvl" class="tiny-input" value="50" oninput="calculate()"></div>`;
  else if (ballType === 'love') html = `<div class="input-group"><label>‡πÄ‡∏û‡∏®‡∏ï‡∏£‡∏á‡∏Ç‡πâ‡∏≤‡∏°‡πÉ‡∏ä‡πà‡πÑ‡∏´‡∏° ?</label><label class="toggle-switch"><input type="checkbox" id="is-love" onchange="calculate()"><span class="slider"></span></label></div>`;
  else if (ballType === 'heavy') html = `<span class="context-msg">‚öñÔ∏è ‡∏ô‡πâ‡∏≥‡∏´‡∏ô‡∏±‡∏Å: ${window.currentWeight}kg</span>`;
  else if (ballType === 'fast') html = `<span class="context-msg">üí® ‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏£‡πá‡∏ß: ${window.currentSpeed}</span>`;
  else if (ballType === 'net') {
    const isTarget = window.currentTypes.includes('water') || window.currentTypes.includes('bug');
    html = isTarget ? `<span class="context-msg" style="color:var(--hp-green); font-weight:bold">‚úÖ ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (x3.5)</span>` : `<span class="context-msg">‚ùå ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢ (x1)</span>`;
  }
  else html = `<span class="context-msg">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç‡∏û‡∏¥‡πÄ‡∏®‡∏©</span>`;
  
  panel.innerHTML = html;
  calculate(); 
}

window.fetchPokemonData = async function(name) {
  const spinner = document.getElementById('spinner');
  const imgEl = document.getElementById('poke-img');
  
  if (!name) return;
  name = name.toLowerCase();
  logPokeActivity(`Search: ${name}`);
  
  spinner.style.display = 'block'; 
  imgEl.style.opacity = '0.5';

  try {
    const speciesRes = await fetch(`https://pokeapi.co/api/v2/pokemon-species/${name}`);
    if(!speciesRes.ok) throw new Error('Not found');
    const speciesData = await speciesRes.json();
    const pokeRes = await fetch(`https://pokeapi.co/api/v2/pokemon/${speciesData.id}`);
    const pokeData = await pokeRes.json();

    window.currentBaseRate = speciesData.capture_rate;
    window.currentWeight = pokeData.weight / 10; 
    window.currentTypes = pokeData.types.map(t => t.type.name);
    window.currentSpeed = pokeData.stats.find(s => s.stat.name === 'speed').base_stat;

    imgEl.src = pokeData.sprites.other['official-artwork'].front_default || pokeData.sprites.front_default;
    document.getElementById('cr-display').textContent = window.currentBaseRate;
    document.getElementById('weight-display').textContent = window.currentWeight;
    document.getElementById('poke-search').value = name.charAt(0).toUpperCase() + name.slice(1);

    const badgesEl = document.getElementById('info-badges');
    badgesEl.innerHTML = '';
    window.currentTypes.forEach(t => {
      const badge = document.createElement('span');
      badge.className = 'badge'; badge.textContent = t;
      badge.style.backgroundColor = typeColors[t] || '#777';
      badgesEl.appendChild(badge);
    });

    window.updateContextPanel(window.currentBall); 
    
    calculate();
  } catch (e) { console.error(e); } 
  finally { spinner.style.display = 'none'; imgEl.style.opacity = '1'; }
}

window.switchTab = function(tabName) {
  document.querySelectorAll('.grid-options-balls').forEach(el => el.classList.remove('active'));
  document.getElementById(`grid-${tabName}`).classList.add('active');
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
  event.target.classList.add('active');
}

document.addEventListener('DOMContentLoaded', async () => {
  logPokeActivity("Open Simulation");
  const searchInput = document.getElementById('poke-search');
  const suggestionsList = document.getElementById('suggestions');
  const toggleArrow = document.getElementById('toggle-arrow');
  const btnThrow = document.getElementById('btn-throw');
  
  document.getElementById('random-tip').textContent = tips[Math.floor(Math.random() * tips.length)];

  try {
    const res = await fetch('https://pokeapi.co/api/v2/pokemon-species?limit=1025');
    const data = await res.json();
    window.allPokemonNames = data.results.map(p => p.name);
    searchInput.disabled = false;
    searchInput.placeholder = "‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠...";
    calculate(); 
  } catch (e) { console.error(e); }

  function updateSuggestions(val, forceShowAll) {
    suggestionsList.innerHTML = '';
    let matches = [];
    if (forceShowAll) {
      matches = window.allPokemonNames; 
    } else if (val) {
      matches = window.allPokemonNames.filter(n => n.startsWith(val.toLowerCase()));
    } else {
      suggestionsList.classList.remove('active');
      return;
    }
    
    if (matches.length > 0) {
      suggestionsList.classList.add('active');
      const fragment = document.createDocumentFragment();
      const renderList = forceShowAll ? matches : matches.slice(0, 100);

      renderList.forEach(match => {
        const li = document.createElement('li');
        li.textContent = match.charAt(0).toUpperCase() + match.slice(1);
        li.onclick = () => { 
          window.fetchPokemonData(match); 
          suggestionsList.classList.remove('active'); 
        };
        fragment.appendChild(li);
      });
      suggestionsList.appendChild(fragment);
    } else {
      suggestionsList.classList.remove('active');
    }
  }

  toggleArrow.addEventListener('click', (e) => { 
    e.stopPropagation(); 
    if(suggestionsList.classList.contains('active')) suggestionsList.classList.remove('active');
    else updateSuggestions('', true); 
  });

  searchInput.addEventListener('click', (e) => { 
    e.stopPropagation();
    searchInput.select(); 
    if(window.allPokemonNames.length) updateSuggestions(searchInput.value, searchInput.value === '');
  });

  searchInput.addEventListener('input', (e) => updateSuggestions(e.target.value, false));

  document.addEventListener('click', (e) => { 
    if(!e.target.closest('.search-wrapper')) suggestionsList.classList.remove('active'); 
  });

  document.querySelectorAll('input[name="ball"]').forEach(r => {
    r.addEventListener('change', (e) => { window.updateContextPanel(e.target.value); window.calculate(); });
  });
  document.getElementById('hp-slider').addEventListener('input', window.calculate);
  document.querySelectorAll('input[name="status"]').forEach(r => r.addEventListener('change', window.calculate));

  btnThrow.addEventListener('click', () => {
    logPokeActivity(`Throw: ${window.currentBall} at ${searchInput.value}`);
    const ballEl = document.querySelector('input[name="ball"]:checked');
    if(!ballEl) return;
    const ballImg = ballEl.getAttribute('data-img');
    const overlay = document.getElementById('overlay');
    const animBallContainer = document.getElementById('anim-ball-container');
    const animText = document.getElementById('anim-text');
    
    btnThrow.disabled = true; 
    overlay.classList.add('active');
    
    playSound('throw');
    animBallContainer.innerHTML = `<img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/${ballImg}.png" class="pokeball-anim-img" style="transform: scale(0.5); opacity: 0; transition: 0.5s all; margin-bottom: 200px;">`;
    animText.textContent = "‡∏õ‡∏≤‡∏ö‡∏≠‡∏•‡πÑ‡∏õ‡πÅ‡∏•‡πâ‡∏ß!";

    setTimeout(() => {
        playSound('hit');
        animBallContainer.innerHTML = `<img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/${ballImg}.png" class="pokeball-anim-img">`;
        animText.textContent = "...";
    }, 600);

    const success = Math.random() * 100 <= window.currentProbability;
    const shakes = success ? 3 : Math.floor(Math.random() * 3);

    const doShake = (count, max) => {
        if (count > max) {
            if (success) {
                playSound('catch');
                animText.innerHTML = '<span style="color:#4bc05b">‚ú® ‡∏à‡∏±‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‚ú®</span>';
                animBallContainer.innerHTML = `<img src="https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/${ballImg}.png" class="pokeball-anim-img" style="filter: brightness(1.2);">`;
            } else {
                playSound('escape');
                animText.innerHTML = '<span style="color:#ff5040">üí¢ ‡πÇ‡∏õ‡πÄ‡∏Å‡∏°‡∏≠‡∏ô‡∏´‡∏ô‡∏µ‡πÑ‡∏õ‡πÑ‡∏î‡πâ!</span>';
                animBallContainer.innerHTML = `<div style="font-size:3em;">üí•</div>`;
            }
            setTimeout(() => { overlay.classList.remove('active'); btnThrow.disabled = false; }, 2000);
            return;
        }

        setTimeout(() => {
            playSound('shake');
            const img = animBallContainer.querySelector('img');
            if(img) {
                img.classList.remove('shake-anim');
                void img.offsetWidth;
                img.classList.add('shake-anim');
            }
            doShake(count + 1, max);
        }, 1000);
    };

    setTimeout(() => {
        doShake(1, shakes);
    }, 1200);
  });
});
</script>
</body>
</html>




